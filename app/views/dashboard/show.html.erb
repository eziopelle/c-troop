<div class=container>
  <div class="title-dashboard">
    <%= image_tag "logo.png" %>
    <h1>Tableau de bord</h1>
  </div>
  <div class="map-dashboard" data-controller="map" data-map-markers-value="<%= @markers.to_json %>"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    <div style="height: 30vh; margin: auto"
      data-map-target="map">
    </div>
  </div>

    <% @total_product = 0 %>
    <% @nb_product = 0 %>
    <% Ticket.all.each do |total| %>
      <% total.market.price_level  %>
      <% @total_product += total.market.price_level - 1%>
      <% @nb_product += 1  %>
    <% end %>

  <div class="resume-card">
      <% @total_sum = 0 %>
      <% Ticket.all.each do |total|  %>
        <% @total_sum += total.total_price %>
      <% end %>
      <h2>Décembre 2022 </h2>
      <p><%= @nb_product %> tickets enregistrés</p>

    <div class="info-price">

      <div class="price-ticket">
        <h2><%= @total_sum.round(2) %> €</h2>
        <%= image_tag "c.svg" %>
      </div>
      <div>
      <% if @total_product.negative? %>
        <p><strong> - <%=  (((@total_product) * 100)/@nb_product).round(0) %>% de moins</strong> la moyenne ! 👏</p>
      <% elsif @total_product.positive?%>
        <p><strong> + <%=  (((@total_product) * 100)/@nb_product).round(0) %>% de plus</strong> que la moyenne ! 🥲</p>
      <% else %>
        <p>Pas d'économies, pas de pertes ce mois-ci</p>
      <% end %>
      </div>

    </div>
  </div>

  <% Ticket.all.reverse.each do |last|  %>
    <div class="tickets-card">
      <% if last.market_id != nil %>
        <h2><%= last.market.brand %></h2>
      <% else %>
        <p>Supermarché non identifié</p>
      <% end %>
      <p><%= last.market.address %></p>

      <div class="price-ticket">
        <h2><%= last.total_price %>€</h2>
        <%= image_tag "c.svg" %>

      </div>

    <p class="date-ticket"><%= last.created_at.strftime('%d/%m/%Y')%></p>
    </div>
      <% end %>
</div>

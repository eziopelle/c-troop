<div class="all-dashboard">
  <div class="show-cards">
    <div class="dashbooard" data-controller="dashboard">
      <h2>Tableau de bord</h2>
    </div>
    <div class="map-dashboard" data-controller="map" data-map-markers-value="<%= @markers.to_json %>"
      data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
      <div style="height: 30vh; margin: auto"
        data-map-target="map">
      </div>
    </div>
    <div class="flexito dashboard-right">
      <div class="total-price blockito depense-month">
        <% @total_sum = 0 %>
        <% Ticket.all.each do |total|  %>
          <% @total_sum += total.total_price %>
        <% end %>
        <div class="total-sum-per-month"><p>Décembre 2022</p></div>
        <div class="total-sum-per-month-price">
          <div class="logo-c">
            <img src="/assets/logo-468bb0c0d657ec64f41ff51bd423d11dd7fb5e144e2b5fbf7ff74921f09b19a0.png" style="
    height: 18vh;">
          </div>
          <div class="sum-month">
            <p><%= @total_sum.round(2) %> €</p>
          </div>
        </div>
      </div>
      <div class="economy-dashboard depense-month">
        <div>
          <% @total_product = 0 %>
          <% @nb_product = 0 %>
          <% Ticket.all.each do |total| %>
            <% total.market.price_level  %>
            <% @total_product += total.market.price_level - 1%>
            <% @nb_product += 1  %>
          <% end %>
          <p>
            <% if @total_product.negative? %>
              <p>Vous économisez <%=  (((@total_product) * 100)/@nb_product).round(0) %>% par rapport à la moyenne ce mois-ci</p>
            <% elsif @total_product.positive?%>
              <p>Vous payez vos courses <%=  (((@total_product) * 100)/@nb_product).round(0) %>% de plus que la moyenne ce mois-ci</p>
            <% else %>
              <p>Pas d'économies, pas de pertes ce mois-ci</p>
            <% end %>
          </p>
        </div>
        <div class="nb-tickets">
          <p><%= @nb_product %> tickets enregistrés</p>
        </div>
        <div class="nb-tickets">
          <% @total_markets = 0 %>
          <% Ticket.all.each do |total|%>
            <% if total.market_id != nil %>
              <% @total_markets += 1  %>
            <% else %>
              <% @total_markets += 0 %>
            <% end %>
          <% end %>
          <p><%= @nb_markets %> supermarchés visités</p>
        </div>
      </div>
    </div>
  <div class="price-dashboard" style="height: 29vh; overflow: scroll;">
    <% Ticket.all.reverse.each do |last|  %>
        <div class="container flexito each-last">
          <div class="blockito">
            <div class="market-brand">
              <% if last.market_id != nil %>
                <p><%= last.market.brand %></p>
              <% else %>
                <p>Supermarché non identifié</p>
              <% end %>
            </div>
            <div class="blockito">
              <div class="dashboard-adress-market">
                <%= last.market.address %>
              </div>
              <div class="dashboard-created-at">
                <%= last.created_at.strftime('Créé le : %d/%m/%Y')%>
              </div>
            </div>
          </div>
          <div class="last-total-price">
            <p><%= last.total_price %>€</p>
          </div>
        </div>
    <% end %>
</div>
